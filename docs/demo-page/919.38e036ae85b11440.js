"use strict";(self.webpackChunkdiagnostics_app=self.webpackChunkdiagnostics_app||[]).push([[919],{1919:(Ot,w,c)=>{c.r(w),c.d(w,{RmaModule:()=>wt});var V=c(9970),h=c(5861),v=c(6039),g=c(6657),O=c(383),u=function(s){return s[s.DIAGNOSTICS=0]="DIAGNOSTICS",s[s.ROUTINE_V2=1]="ROUTINE_V2",s[s.CAMERA=2]="CAMERA",s[s.AUDIO=3]="AUDIO",s}(u||{});const k=[{title:"Custom Camera Test",enabled:!0,testType:u.CAMERA,testArgument:null},{title:"Custom Audio Test",enabled:!0,testType:u.AUDIO,testArgument:null},{title:"Memory Test V2",enabled:!0,testType:u.ROUTINE_V2,testArgument:{[v.GX.MEMORY]:{maxTestingMemKib:1e4}}},{title:"Fan Test V2",enabled:!0,testType:u.ROUTINE_V2,testArgument:{[v.GX.FAN]:{}}},{title:"Volume Button Test V2",enabled:!0,testType:u.ROUTINE_V2,testArgument:{[v.GX.VOLUME_BUTTON]:{buttonType:O.k0.volume_up,timeoutSeconds:10}}},{title:"CPU Stress Test V1",enabled:!0,testType:u.DIAGNOSTICS,testArgument:{category:g.cU.cpu_stress,argument:{length_seconds:10}}},{title:"CPU Cache Test V1",enabled:!0,testType:u.DIAGNOSTICS,testArgument:{category:g.cU.cpu_cache,argument:{length_seconds:10}}},{title:"Prime Search Test V1",enabled:!0,testType:u.DIAGNOSTICS,testArgument:{category:g.cU.cpu_prime_search,argument:{length_seconds:10}}},{title:"Floating Point Test V1",enabled:!0,testType:u.DIAGNOSTICS,testArgument:{category:g.cU.cpu_floating_point_accuracy,argument:{length_seconds:10}}}];var C=c(5619),t=c(5879),_=c(381),S=c(7565),y=c(1298);let T=(()=>{class s{static#t=this.AUDIT_PAGE_INDEX=-1;constructor(e,n,i,o){this.loggingService=e,this.diagnosticsService=n,this.routineV2Service=i,this.ngZone=o,this.testList=new C.X([]),this.currentTestIndex=new C.X(s.AUDIT_PAGE_INDEX),this.testResults=new C.X([]),this.isRunning=new C.X(!1),this.init()}init(){var e=this;return(0,h.Z)(function*(){e.testList.next(yield e.filterSupported(k)),e.testResults.next(Array(e.testList.getValue().length).fill(null)),e.setCurrentTestIndex(s.AUDIT_PAGE_INDEX)})()}filterSupported(e){var n=this;return(0,h.Z)(function*(){try{const i=n.diagnosticsService.getAvailableRoutines(),o=[];for(const l of e)l.testType===u.ROUTINE_V2&&o.push(n.routineV2Service.isRoutineArgumentSupported(l.testArgument));const[a]=yield Promise.all([i,...o]),p=a.routines;for(const l of e){if(l.testType===u.DIAGNOSTICS&&(l.supported=p.includes(l.testArgument.category)),l.testType===u.ROUTINE_V2){const I=yield n.routineV2Service.isRoutineArgumentSupported(l.testArgument);l.supported=I.status===O.DR.supported}l.testType===u.CAMERA&&(l.supported=!0),l.testType===u.AUDIO&&(l.supported=!0),null!==l.supported&&!l.supported&&(l.enabled=!1)}}catch(i){n.loggingService.error("Error occurred:"+String(i))}return e})()}getCurrentTestIndex$(){return this.currentTestIndex.asObservable()}getTestList$(){return this.testList.asObservable()}getTestResults$(){return this.testResults.asObservable()}setCurrentTestIndex(e){this.ngZone.run(()=>{this.currentTestIndex.next(e)})}getTestResult(e){return e<0||e>=this.testResults.getValue().length?(this.loggingService.error("Invalid index access to testResults: "+e),null):this.testResults.getValue()[e]}getTestConfig(e){return e<0||e>=this.testResults.getValue().length?(this.loggingService.error("Invalid index access to testList: "+e),null):this.testList.getValue()[e]}getIsRunning$(){return this.isRunning.asObservable()}getIsRunningValue(){return this.isRunning.getValue()}setIsRunning(e){this.ngZone.run(()=>{this.isRunning.next(e)})}setTestlistEnabled(e,n){this.ngZone.run(()=>{const i=this.testList.getValue();i[e].enabled=n,this.testList.next(i)})}startTests(){this.isRunning.value||(this.setCurrentTestIndex(s.AUDIT_PAGE_INDEX),this.loggingService.info("Start running tests"),this.clearResultCache(),this.setIsRunning(!0),this.runNextTest())}runNextTest(){if(this.isRunning.value){let e=this.currentTestIndex.value+1;for(;e<this.testList.getValue().length;){if(this.testList.getValue().at(e)?.enabled)return void this.setCurrentTestIndex(e);e++}this.stopTests()}}stopTests(){this.isRunning.value&&(this.loggingService.info("Stop running tests"),this.setCurrentTestIndex(s.AUDIT_PAGE_INDEX),this.setIsRunning(!1))}saveTestResult(e,n){const i=this.testResults.getValue();i[e]=n,this.testResults.next(i)}clearResultCache(){this.testResults.next(Array(this.testList.getValue().length).fill(null))}markTestComplete(){this.isRunning.getValue()&&this.runNextTest()}static#e=this.\u0275fac=function(n){return new(n||s)(t.LFG(_.e),t.LFG(S.w),t.LFG(y.w),t.LFG(t.R0b))};static#n=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var d=c(6814);const F=["video"],G=["canvas"];function J(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.rotateVideoInput(!0))}),t.qZA()}}class A{constructor(r,e,n){this._mimeType=null,this._imageAsBase64=null,this._imageAsDataUrl=null,this._imageData=null,this._mimeType=e,this._imageAsDataUrl=r,this._imageData=n}static getDataFromDataUrl(r,e){return r.replace(`data:${e};base64,`,"")}get imageAsBase64(){return this._imageAsBase64?this._imageAsBase64:this._imageAsBase64=A.getDataFromDataUrl(this._imageAsDataUrl,this._mimeType)}get imageAsDataUrl(){return this._imageAsDataUrl}get imageData(){return this._imageData}}class L{static getAvailableVideoInputs(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?new Promise((r,e)=>{navigator.mediaDevices.enumerateDevices().then(n=>{r(n.filter(i=>"videoinput"===i.kind))}).catch(n=>{e(n.message||n)})}):Promise.reject("enumerateDevices() not supported.")}}let U=(()=>{class s{constructor(){this.width=640,this.height=480,this.videoOptions=s.DEFAULT_VIDEO_OPTIONS,this.allowCameraSwitch=!0,this.captureImageData=!1,this.imageType=s.DEFAULT_IMAGE_TYPE,this.imageQuality=s.DEFAULT_IMAGE_QUALITY,this.imageCapture=new t.vpe,this.initError=new t.vpe,this.imageClick=new t.vpe,this.cameraSwitched=new t.vpe,this.availableVideoInputs=[],this.videoInitialized=!1,this.activeVideoInputIndex=-1,this.mediaStream=null,this.activeVideoSettings=null}set trigger(e){this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.triggerSubscription=e.subscribe(()=>{this.takeSnapshot()})}set switchCamera(e){this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe(),this.switchCameraSubscription=e.subscribe(n=>{"string"==typeof n?this.switchToVideoInput(n):this.rotateVideoInput(!1!==n)})}static getMediaConstraintsForDevice(e,n){const i=n||this.DEFAULT_VIDEO_OPTIONS;return e&&(i.deviceId={exact:e}),i}static getDeviceIdFromMediaStreamTrack(e){if(e.getSettings&&e.getSettings()&&e.getSettings().deviceId)return e.getSettings().deviceId;if(e.getConstraints&&e.getConstraints()&&e.getConstraints().deviceId){const n=e.getConstraints().deviceId;return s.getValueFromConstrainDOMString(n)}}static getFacingModeFromMediaStreamTrack(e){if(e){if(e.getSettings&&e.getSettings()&&e.getSettings().facingMode)return e.getSettings().facingMode;if(e.getConstraints&&e.getConstraints()&&e.getConstraints().facingMode){const n=e.getConstraints().facingMode;return s.getValueFromConstrainDOMString(n)}}}static isUserFacing(e){const n=s.getFacingModeFromMediaStreamTrack(e);return!!n&&"user"===n.toLowerCase()}static getValueFromConstrainDOMString(e){if(e){if(e instanceof String)return String(e);if(Array.isArray(e)&&Array(e).length>0)return String(e[0]);if("object"==typeof e){if(e.exact)return String(e.exact);if(e.ideal)return String(e.ideal)}}return null}ngAfterViewInit(){this.detectAvailableDevices().then(()=>{this.switchToVideoInput(null)}).catch(e=>{this.initError.next({message:e}),this.switchToVideoInput(null)})}ngOnDestroy(){this.stopMediaTracks(),this.unsubscribeFromSubscriptions()}takeSnapshot(){const e=this.nativeVideoElement,n={width:this.width,height:this.height};e.videoWidth&&(n.width=e.videoWidth,n.height=e.videoHeight);const i=this.canvas.nativeElement;i.width=n.width,i.height=n.height;const o=i.getContext("2d");o.drawImage(e,0,0);const a=this.imageType?this.imageType:s.DEFAULT_IMAGE_TYPE,l=i.toDataURL(a,this.imageQuality?this.imageQuality:s.DEFAULT_IMAGE_QUALITY);let I=null;this.captureImageData&&(I=o.getImageData(0,0,i.width,i.height)),this.imageCapture.next(new A(l,a,I))}rotateVideoInput(e){this.availableVideoInputs&&this.availableVideoInputs.length>1&&this.switchToVideoInput(this.availableVideoInputs[(this.activeVideoInputIndex+(e?1:this.availableVideoInputs.length-1))%this.availableVideoInputs.length].deviceId)}switchToVideoInput(e){this.videoInitialized=!1,this.stopMediaTracks(),this.initWebcam(e,this.videoOptions)}videoResize(){}get videoWidth(){const e=this.getVideoAspectRatio();return Math.min(this.width,this.height*e)}get videoHeight(){const e=this.getVideoAspectRatio();return Math.min(this.height,this.width/e)}get videoStyleClasses(){let e="";return this.isMirrorImage()&&(e+="mirrored "),e.trim()}get nativeVideoElement(){return this.video.nativeElement}getVideoAspectRatio(){const e=this.nativeVideoElement;return e.videoWidth&&e.videoWidth>0&&e.videoHeight&&e.videoHeight>0?e.videoWidth/e.videoHeight:this.width/this.height}initWebcam(e,n){const i=this.nativeVideoElement;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const o=s.getMediaConstraintsForDevice(e,n);navigator.mediaDevices.getUserMedia({video:o}).then(a=>{this.mediaStream=a,i.srcObject=a,i.play(),this.activeVideoSettings=a.getVideoTracks()[0].getSettings();const p=s.getDeviceIdFromMediaStreamTrack(a.getVideoTracks()[0]);this.cameraSwitched.next(p),this.detectAvailableDevices().then(()=>{this.activeVideoInputIndex=p?this.availableVideoInputs.findIndex(l=>l.deviceId===p):-1,this.videoInitialized=!0}).catch(()=>{this.activeVideoInputIndex=-1,this.videoInitialized=!0})}).catch(a=>{this.initError.next({message:a.message,mediaStreamError:a})})}else this.initError.next({message:"Cannot read UserMedia from MediaDevices."})}getActiveVideoTrack(){return this.mediaStream?this.mediaStream.getVideoTracks()[0]:null}isMirrorImage(){if(!this.getActiveVideoTrack())return!1;{let e="auto";switch(this.mirrorImage&&("string"==typeof this.mirrorImage?e=String(this.mirrorImage).toLowerCase():this.mirrorImage.x&&(e=this.mirrorImage.x.toLowerCase())),e){case"always":return!0;case"never":return!1}}return s.isUserFacing(this.getActiveVideoTrack())}stopMediaTracks(){this.mediaStream&&this.mediaStream.getTracks&&(this.nativeVideoElement.pause(),this.mediaStream.getTracks().forEach(e=>e.stop()))}unsubscribeFromSubscriptions(){this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe()}detectAvailableDevices(){return new Promise((e,n)=>{L.getAvailableVideoInputs().then(i=>{this.availableVideoInputs=i,e(i)}).catch(i=>{this.availableVideoInputs=[],n(i)})})}}return s.DEFAULT_VIDEO_OPTIONS={facingMode:"environment"},s.DEFAULT_IMAGE_TYPE="image/jpeg",s.DEFAULT_IMAGE_QUALITY=.92,s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["webcam"]],viewQuery:function(e,n){if(1&e&&(t.Gf(F,7),t.Gf(G,7)),2&e){let i;t.iGM(i=t.CRH())&&(n.video=i.first),t.iGM(i=t.CRH())&&(n.canvas=i.first)}},inputs:{width:"width",height:"height",videoOptions:"videoOptions",allowCameraSwitch:"allowCameraSwitch",mirrorImage:"mirrorImage",captureImageData:"captureImageData",imageType:"imageType",imageQuality:"imageQuality",trigger:"trigger",switchCamera:"switchCamera"},outputs:{imageCapture:"imageCapture",initError:"initError",imageClick:"imageClick",cameraSwitched:"cameraSwitched"},decls:6,vars:7,consts:[[1,"webcam-wrapper",3,"click"],["autoplay","","muted","","playsinline","",3,"width","height","resize"],["video",""],["class","camera-switch",3,"click",4,"ngIf"],[3,"width","height"],["canvas",""],[1,"camera-switch",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.NdJ("click",function(){return n.imageClick.next()}),t.TgZ(1,"video",1,2),t.NdJ("resize",function(){return n.videoResize()}),t.qZA(),t.YNc(3,J,1,0,"div",3),t._UZ(4,"canvas",4,5),t.qZA()),2&e&&(t.xp6(1),t.Tol(n.videoStyleClasses),t.Q6J("width",n.videoWidth)("height",n.videoHeight),t.xp6(2),t.Q6J("ngIf",n.allowCameraSwitch&&n.availableVideoInputs.length>1&&n.videoInitialized),t.xp6(1),t.Q6J("width",n.width)("height",n.height))},dependencies:[d.O5],styles:[".webcam-wrapper[_ngcontent-%COMP%]{display:inline-block;position:relative;line-height:0}.webcam-wrapper[_ngcontent-%COMP%]   video.mirrored[_ngcontent-%COMP%]{transform:scaleX(-1)}.webcam-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:none}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]{background-color:#0000001a;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAE9UlEQVR42u2aT2hdRRTGf+cRQqghSqihdBFDkRISK2KDfzDWxHaRQHEhaINKqa1gKQhd6EZLN+IidCH+Q0oWIkVRC21BQxXRitVaSbKoJSGtYGoK2tQ/tU1jY5v0c5F54Xl7b/KSO/PyEt+3e5f75p7zzZwzZ74zUEIJJfyfYaEGllQGVAGZlENdBy6Z2cSiYFTSKkkfS/pH/nBF0kFJdUW9AiRVASeAukD8DgNrzOySrwEzng18KaDzALXuG8W3AiStAvqBisBRNg40mtlPxbYCOgvgPO4bncWW+JpVeDQXRQhIygDfA00F5r0XuNfMrgclQFI98DDQCNQA5ZFXqoCWBVp8XwHRHeEqcN7loy/NbHBesyqpQ1KfFj/6nC+ZvFaApFrgPaCZpYVvgCfNbDiRAElNwGFg+RIt/X8H2s2s9wYCJDUAR4HqJX7++RN40MwGpgmQVAH0AQ2BPz4AHHPl8nBOAqtyFWQjsA6oL4Ada81sPDv7uwImod8kvSJp9RyS8O2SXnb/DYVd2Y9VSroQ4ANXJO2WVJmixqh0kzMWwL4LkiqRtDnA4D1zmfE8j9g9AezcnAHaPcfXdbfdnPZ2Yps6+DwAvO/Z1naTdApY7Xng48BDZnY1MpMVQBuw3iXc5Tnb0wBwBPjUzP6eoezuArZ6svM0geJLkvZEYnl3nkntoqROSbckSW2Suj3ZOIangc7GPJuUtNGdFIfmMeavktoSSKiW9LMPw30Q8JqkekmjCbOZRhuclLQjgYSNxUBAj6RyZ9ATgUJpUtJTCSR8vpAEXHAyWK5BXYFIGHOlepSAloUk4NEYgyoknQhEwhFJ0e8h6VSaQeerCb5uZgdi9utxYBNwOUD93hIVXswM4INCi6K9wAszFC2DwLOBDjHbYp59karIUnRdzYy/3ClqVklaUhfwTICj7K25OqA7a4wWagVsm4Me/xzwg2cCqqONFzO7DPxSCAJi436GUBgHHguQD2oTlJ55oSzP9ybccsttSJw1szdjFOSnI/8dTCGZHwcORp4Nx7y3B1iZ8/sm4MW8/Euxg5wIsS/HaAp3zeP4/G7obRDXI4jiTIA22H7Xdc7X+S3A5lC7QBQ357aq3VAjCeSkwUfAJrfvz+R8A9ADLAtZB+TinpjC5JMA+//jwPZZnF8G7J+L8z4IWB/zbG+gIujVWfLBW/NStVMmqaG4POJRsIjix7h8IGnLQuoBbQki5sVAJHyYm7YkNaRRtXwQ8G1cHpX0iKRrgUjYno17Sf0LrQhJUkdCeHWkVITGJI0k1QeS3ikGSUzOyJUJJNznYneuOCnpTldcxa2kP3xJYqOeSDjqZG8ShJLnE8TTuMS6Iyu1BW7djZqkfo9N0QOuYJmYQddfB7RG+gLTNzqAY9FrL+5/nwEbvDdJJe3zzOrhNP3AWRqmk55t3ZcBuj3b2gb0Sbrbo/NNzk7fFzu7s/E5EiC+rrmeQU0Kx2skvRFoOx2ZzlmSdgbsw49JetvtBpk8nM64d/cGbNtJ0s7cGyJlwHeEv+t3nqnLSgPAUOSGyG3AHUxdzqoJbEcvcL+ZTeTeEapzJKxgaeOcc/7Mf06D7kFrguS0VDAMtGadv+E47DT9tcChJej8ISfpD+abgTe45uOkFi8mnQ+JBVQ+d4VXuOptjavcyot8pq86mfwk8LWZnaOEEkoooYQSSojDv8AhQNeGfe0jAAAAAElFTkSuQmCC);background-repeat:no-repeat;border-radius:5px;position:absolute;right:13px;top:10px;height:48px;width:48px;background-size:80%;cursor:pointer;background-position:center;transition:background-color .2s ease}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]:hover{background-color:#0000002e}"]}),s})(),Q=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[d.ez]]}),s})();var Z=c(4408),E=c(1088),Y=c(7398),q=c(940),x=c(735),z=c(1274),j=c(2453);function X(s,r){if(1&s&&(t.TgZ(0,"div"),t._uU(1," ["),t.TgZ(2,"span"),t._uU(3),t.qZA(),t._uU(4),t.qZA()),2&s){const e=r.$implicit,n=t.oxw();t.xp6(2),t.Tol(e.level),t.xp6(1),t.Oqu(e.level),t.xp6(1),t.AsE("] ",n.formatTimestamp(e.timestamp),": ",e.message,"\n")}}let H=(()=>{class s{formatTimestamp(e){return e.toISOString()}constructor(e){this.loggingService=e,this.logs$=this.loggingService.getLogs()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(_.e))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-log-viewer"]],decls:2,vars:3,consts:[[4,"ngFor","ngForOf"]],template:function(n,i){1&n&&(t.YNc(0,X,5,6,"div",0),t.ALo(1,"async")),2&n&&t.Q6J("ngForOf",t.lcZ(1,1,i.logs$))},dependencies:[d.sg,d.Ov]})}return s})();var b=c(2296),W=c(1175),B=c(2098);function K(s,r){1&s&&(t.TgZ(0,"mat-icon",8),t._uU(1,"check_circle"),t.qZA())}function $(s,r){1&s&&(t.TgZ(0,"mat-icon",9),t._uU(1,"cancel"),t.qZA())}const tt=function(s,r){return{active:s,unsupported:r}};function et(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div")(1,"div",2),t.NdJ("click",function(i){const a=t.CHM(e).index,p=t.oxw();return t.KtG(p.isRunning||p.isUnsupported(a)?null:p.handleTestNavigation(i,a))}),t.ALo(2,"async"),t.TgZ(3,"input",4),t.NdJ("click",function(i){const a=t.CHM(e).index,p=t.oxw();return t.KtG(p.handleCheckboxClick(i,a))}),t.qZA(),t._uU(4),t.TgZ(5,"span",5),t.YNc(6,K,2,0,"mat-icon",6),t.YNc(7,$,2,0,"mat-icon",7),t.qZA()()()}if(2&s){const e=r.$implicit,n=r.index,i=t.oxw();t.xp6(1),t.Q6J("ngClass",t.WLB(8,tt,t.lcZ(2,6,i.getCurrentTestIndex$())===n,i.isUnsupported(n))),t.xp6(2),t.Q6J("disabled",i.isRunning||i.isUnsupported(n))("checked",i.testList[n].enabled),t.xp6(1),t.hij(" ",e.title," "),t.xp6(2),t.Q6J("ngIf","passed"===i.getTestStatus(n)),t.xp6(1),t.Q6J("ngIf","failed"===i.getTestStatus(n))}}const nt=function(s){return{active:s}};let it=(()=>{class s{constructor(e,n){this.testOrchestrator=e,this.loggingService=n,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.testOrchestrator.getCurrentTestIndex$().subscribe(e=>{this.testIndex=e}),this.testOrchestrator.getIsRunning$().subscribe(e=>{this.isRunning=e}),this.testOrchestrator.getTestList$().subscribe(e=>{this.testList=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}handleTestNavigation(e,n){this.testOrchestrator.setCurrentTestIndex(n)}handleCheckboxClick(e,n){e.stopPropagation(),this.testOrchestrator.setTestlistEnabled(n,e.target.checked)}startTests(){this.testOrchestrator.startTests()}stopTests(){this.testOrchestrator.stopTests()}getCurrentTestIndex$(){return this.testOrchestrator.getCurrentTestIndex$()}getTestStatus(e){const n=this.testOrchestrator.getTestResult(e);return null===n?"pending":n.passed?"passed":"failed"}isUnsupported(e){return null!==this.testList[e].supported&&!this.testList[e].supported}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(T),t.Y36(_.e))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-rma-sidebar"]],decls:11,vars:8,consts:[[1,"top-button-row"],["mat-raised-button","",1,"test-operation-button",3,"disabled","click"],[1,"mat-subheader;","menu-navigation-button",3,"ngClass","click"],[4,"ngFor","ngForOf"],["type","checkbox",3,"disabled","checked","click"],[1,"show-icon"],["style","color: green",4,"ngIf"],["style","color: red",4,"ngIf"],[2,"color","green"],[2,"color","red"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return i.startTests()}),t._uU(2," Run Tests "),t.qZA(),t.TgZ(3,"button",1),t.NdJ("click",function(){return i.stopTests()}),t._uU(4," Stop Tests "),t.qZA()(),t.TgZ(5,"div",2),t.NdJ("click",function(a){return i.isRunning?null:i.handleTestNavigation(a,-1)}),t.ALo(6,"async"),t._uU(7," Audit Page\n"),t.qZA(),t.YNc(8,et,8,11,"div",3),t.TgZ(9,"div"),t._UZ(10,"mat-nav-list"),t.qZA()),2&n&&(t.xp6(1),t.Q6J("disabled",i.isRunning),t.xp6(2),t.Q6J("disabled",!i.isRunning),t.xp6(2),t.Q6J("ngClass",t.VKq(6,nt,-1===t.lcZ(6,4,i.getCurrentTestIndex$()))),t.xp6(3),t.Q6J("ngForOf",i.testList))},dependencies:[d.mk,d.sg,d.O5,b.lW,W.Hw,B.Hk,d.Ov],styles:[".hover-finger[_ngcontent-%COMP%]{cursor:pointer}.active[_ngcontent-%COMP%]{font-weight:600;color:var(--app-sidenav-item-active-color)}.mat-subheader[_ngcontent-%COMP%]{color:var(--app-sidenav-subheader-color);font-size:20px}.menu-navigation-button[_ngcontent-%COMP%]{height:40px;font-size:18px;padding-left:30px;padding-bottom:10px}.top-button-row[_ngcontent-%COMP%]{height:60px;display:flex;justify-content:space-between}.test-operation-button[_ngcontent-%COMP%]{margin-right:20px;margin-left:20px}.menu-navigation-button[_ngcontent-%COMP%]:hover{color:var(--app-sidenav-item-active-color);cursor:pointer}.show-icon[_ngcontent-%COMP%]{position:sticky;z-index:1;font-size:40%;vertical-align:-.7em}.unsupported[_ngcontent-%COMP%], .unsupported[_ngcontent-%COMP%]:hover{color:var(--color-medium-grey)}"]})}return s})();function st(s,r){1&s&&t._UZ(0,"div")}function ot(s,r){1&s&&t._uU(0,' Press "Run this test only" to start the test ')}function rt(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",4)(1,"button",5),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.isRecording?i.stopRecording():i.startRecording())}),t._uU(2),t.qZA(),t._UZ(3,"audio",6),t.qZA(),t.TgZ(4,"div",7)(5,"p"),t._uU(6,"Can you hear yourself after recording from microphone?"),t.qZA(),t.TgZ(7,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.submitTestResult(!0))}),t._uU(8," Yes "),t.qZA(),t.TgZ(9,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.submitTestResult(!1))}),t._uU(10," No "),t.qZA()()}if(2&s){const e=t.oxw();t.xp6(2),t.hij(" ",e.isRecording?"Stop Recording":"Start Recording"," "),t.xp6(1),t.Q6J("src",e.recordedAudioUrl,t.LSH)}}let at=(()=>{class s{constructor(e,n,i){this.loggingService=e,this.testOrchestrator=n,this.ngZone=i,this.testCompleted=new t.vpe,this.testRunning=!1,this.isRecording=!1,this.recordedAudioUrl=null,this.mediaRecorder=null}ngOnInit(){this.testOrchestrator.getIsRunningValue()&&this.startRoutine()}startRoutine(){this.testRunning=!0}startRecording(){var e=this;return(0,h.Z)(function*(){if(navigator.mediaDevices.getUserMedia)try{const n=yield navigator.mediaDevices.getUserMedia({audio:!0});e.mediaRecorder=new MediaRecorder(n),e.mediaRecorder.start();const i=[];e.mediaRecorder.ondataavailable=o=>{i.push(o.data)},e.mediaRecorder.onstop=()=>{e.ngZone.run(()=>{const o=new Blob(i);e.recordedAudioUrl=URL.createObjectURL(o)})},e.isRecording=!0}catch(n){e.loggingService.error("Failed to record audio: ",n)}else e.loggingService.error("Media recording is not supported in this browser.")})()}stopRecording(){this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder=null,this.isRecording=!1)}submitTestResult(e){this.testOrchestrator.saveTestResult(this.index,{title:this.title,testType:u.CAMERA,percentage:100,passed:e}),this.testCompleted.emit(),this.testRunning=!1}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(_.e),t.Y36(T),t.Y36(t.R0b))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-audio-test"]],inputs:{index:"index",title:"title",argument:"argument"},outputs:{testCompleted:"testCompleted"},decls:7,vars:4,consts:[[1,"test-title"],[4,"ngIf","ngIfThen","ngIfElse"],["showPreparation",""],["showTest",""],[1,"audio-container"],["mat-raised-button","",1,"record-button",3,"click"],["controls","",3,"src"],[1,"prompt"],["mat-raised-button","",1,"test-operation-button",3,"click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0),t._uU(1),t.qZA(),t.YNc(2,st,1,0,"div",1),t.YNc(3,ot,1,0,"ng-template",null,2,t.W1O),t.YNc(5,rt,11,2,"ng-template",null,3,t.W1O)),2&n){const o=t.MAs(4),a=t.MAs(6);t.xp6(1),t.Oqu(i.title),t.xp6(1),t.Q6J("ngIf",i.testRunning)("ngIfThen",a)("ngIfElse",o)}},dependencies:[d.O5,b.lW],styles:[".test-operation-button[_ngcontent-%COMP%]{font-size:12px;margin:10px;box-sizing:content-box}.test-title[_ngcontent-%COMP%]{line-height:normal;font-size:30px;font-weight:700;flex:0 0 auto}.record-button[_ngcontent-%COMP%]{margin:20px}.audio-container[_ngcontent-%COMP%]{margin:20px;display:flex;flex-direction:row;align-items:center;justify-content:left}"]})}return s})(),ct=(()=>{class s{constructor(){this.testCompleted=new t.vpe}static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-base-test"]],inputs:{index:"index",title:"title",argument:"argument"},outputs:{testCompleted:"testCompleted"},decls:1,vars:0,template:function(n,i){1&n&&t._UZ(0,"div")},encapsulation:2})}return s})();class M{constructor(){this.enabledTests=[],this.passedTests=[],this.failedTests=[],this.unranTests=[],this.disabledTests=[]}}let ut=(()=>{class s extends ct{UpdateTestStatistics(){this.testStatistics=new M;for(const[e,n]of this.testList.entries()){if(!n.enabled){this.testStatistics.disabledTests.push(e);continue}this.testStatistics.enabledTests.push(e);const i=this.testResults[e];i?i.passed?this.testStatistics.passedTests.push(e):i.passed||this.testStatistics.failedTests.push(e):this.testStatistics.unranTests.push(e)}}constructor(e){super(),this.testOrchestrator=e,this.testList=[],this.testResults=[],this.testStatistics=new M,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.testOrchestrator.getTestList$().subscribe(e=>{this.testList=e,this.UpdateTestStatistics()}),this.testOrchestrator.getTestResults$().subscribe(e=>{this.testResults=e,this.UpdateTestStatistics()}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}startRoutine(){}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(T))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-audit-page"]],features:[t.qOj],decls:24,vars:7,consts:[[1,"content-container"],[1,"test-title"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2,"Audit Page"),t.qZA(),t.TgZ(3,"table")(4,"tr")(5,"th"),t._uU(6,"Passed Test:"),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA()(),t.TgZ(9,"tr")(10,"th"),t._uU(11,"Failed Test:"),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA()(),t.TgZ(14,"tr")(15,"th"),t._uU(16,"Unran Test:"),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA()(),t.TgZ(19,"tr")(20,"th"),t._uU(21,"Disabled Test:"),t.qZA(),t.TgZ(22,"td"),t._uU(23),t.qZA()()()()),2&n&&(t.xp6(8),t.AsE("",i.testStatistics.passedTests.length," / ",i.testStatistics.enabledTests.length,""),t.xp6(5),t.AsE("",i.testStatistics.failedTests.length," / ",i.testStatistics.enabledTests.length,""),t.xp6(5),t.AsE("",i.testStatistics.unranTests.length," / ",i.testStatistics.enabledTests.length,""),t.xp6(5),t.Oqu(i.testStatistics.disabledTests.length))},styles:[".content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px}.test-title[_ngcontent-%COMP%]{line-height:normal;font-size:30px;font-weight:700;flex:0 0 auto;margin-bottom:30px}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;position:relative;border-top:1px solid white;border-bottom:1px solid white;border-left:none;border-right:none;border-collapse:collapse}th[_ngcontent-%COMP%]{width:30%}td[_ngcontent-%COMP%]{width:70%}"]})}return s})();function lt(s,r){1&s&&t._UZ(0,"div")}function dt(s,r){1&s&&t._uU(0,' Press "Run this test only" to start the test ')}function gt(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",4)(1,"webcam",5),t.NdJ("initError",function(i){t.CHM(e);const o=t.oxw();return t.KtG(o.handleInitError(i))}),t.qZA(),t.TgZ(2,"div",6)(3,"p"),t._uU(4,"Can you see yourself from the webcam?"),t.qZA(),t.TgZ(5,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.submitTestResult(!0))}),t._uU(6," Yes "),t.qZA(),t.TgZ(7,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.submitTestResult(!1))}),t._uU(8," No "),t.qZA()()()}2&s&&(t.xp6(1),t.Q6J("height",200)("width",200))}let pt=(()=>{class s{constructor(e,n){this.loggingService=e,this.testOrchestrator=n,this.testCompleted=new t.vpe,this.testRunning=!1}ngOnInit(){this.testOrchestrator.getIsRunningValue()&&this.startRoutine()}startRoutine(){this.testRunning=!0}handleInitError(e){this.loggingService.error("Failed to initialize Web Camera: ",e.message)}submitTestResult(e){this.testOrchestrator.saveTestResult(this.index,{title:this.title,testType:u.CAMERA,percentage:100,passed:e}),this.testCompleted.emit(),this.testRunning=!1}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(_.e),t.Y36(T))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-camera-test"]],inputs:{index:"index",title:"title",argument:"argument"},outputs:{testCompleted:"testCompleted"},decls:7,vars:4,consts:[[1,"test-title"],[4,"ngIf","ngIfThen","ngIfElse"],["showPreparation",""],["showTest",""],[1,"webcam-container"],[3,"height","width","initError"],[1,"prompt"],["mat-raised-button","",1,"test-operation-button",3,"click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0),t._uU(1),t.qZA(),t.YNc(2,lt,1,0,"div",1),t.YNc(3,dt,1,0,"ng-template",null,2,t.W1O),t.YNc(5,gt,9,2,"ng-template",null,3,t.W1O)),2&n){const o=t.MAs(4),a=t.MAs(6);t.xp6(1),t.Oqu(i.title),t.xp6(1),t.Q6J("ngIf",i.testRunning)("ngIfThen",a)("ngIfElse",o)}},dependencies:[d.O5,b.lW,U],styles:[".test-operation-button[_ngcontent-%COMP%]{font-size:12px;margin:10px;box-sizing:content-box}.test-title[_ngcontent-%COMP%]{line-height:normal;font-size:30px;font-weight:700;flex:0 0 auto}"]})}return s})();var R=c(1753),N=c(6007),P=c(7881);function ht(s,r){1&s&&t.GkF(0)}function mt(s,r){if(1&s&&t._uU(0),2&s){const e=t.oxw();t.hij(" ",e.output," ")}}const ft=function(s){return{"add-indent":s}};function vt(s,r){if(1&s&&(t.TgZ(0,"div",4)(1,"b"),t._uU(2),t.qZA(),t._UZ(3,"app-json-viewer",5),t.qZA()),2&s){const e=r.$implicit,n=t.oxw(2);t.Q6J("ngClass",t.VKq(4,ft,0!==n.level)),t.xp6(2),t.hij("",e.key,":"),t.xp6(1),t.Q6J("output",e.value)("level",n.level+1)}}function Tt(s,r){if(1&s&&(t.YNc(0,vt,4,6,"div",3),t.ALo(1,"keyvalue")),2&s){const e=t.oxw();t.Q6J("ngForOf",t.xi3(1,1,e.output,e.originalOrder))}}let D=(()=>{class s{constructor(){this.originalOrder=P.p,this.isPrimitiveType=P.t}static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-json-viewer"]],inputs:{output:"output",level:"level"},decls:5,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["renderPrimitive",""],["renderSubobject",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[3,"output","level"]],template:function(n,i){if(1&n&&(t.YNc(0,ht,1,0,"ng-container",0),t.YNc(1,mt,1,1,"ng-template",null,1,t.W1O),t.YNc(3,Tt,2,4,"ng-template",null,2,t.W1O)),2&n){const o=t.MAs(2),a=t.MAs(4);t.Q6J("ngIf",i.isPrimitiveType(i.output))("ngIfThen",o)("ngIfElse",a)}},dependencies:[d.mk,d.sg,d.O5,s,d.Nd],styles:[".add-indent[_ngcontent-%COMP%]{margin-left:20px}"]})}return s})();var m=function(s){return s.READY="ready",s.RUNNING="running",s.STOPPING="stopping",s.WAITING_FOR_USER_ACTION="waiting_for_user_action",s}(m||{});let _t=(()=>{class s{constructor(e,n,i){this.diagnosticsService=e,this.loggingService=n,this.testOrchestrator=i,this.testCompleted=new t.vpe,this.DiagnosticsCardState=m,this.state=m.READY,this.terminalStates=new Set([g.x7.passed,g.x7.failed,g.x7.error,g.x7.cancelled,g.x7.failed_to_start,g.x7.removed,g.x7.unsupported,g.x7.not_run])}ngOnInit(){if(this.testOrchestrator.getIsRunningValue())return void this.startRoutine();const e=this.testOrchestrator.getTestResult(this.index);null!==e&&(this.routineInfo=e.routineInfo)}ngOnDestroy(){this.intervalId&&window.clearInterval(this.intervalId),this.saveResultToCache()}hasPassed(){return this.routineInfo&&this.terminalStates.has(this.routineInfo.status)?this.routineInfo.status===g.x7.passed:null}percentage(){return this.routineInfo?this.routineInfo.progress_percent:0}saveResultToCache(){if(0===this.percentage())return;const e={title:this.title,testType:u.DIAGNOSTICS,passed:null!==this.hasPassed()&&this.hasPassed(),percentage:this.percentage(),routineInfo:this.routineInfo};this.testOrchestrator.saveTestResult(this.index,e)}onTestComplete(){this.testCompleted.emit()}handleResponse(){if(this.routineInfo){if(this.routineInfo.status!==g.x7.waiting_user_action)return this.terminalStates.has(this.routineInfo.status)?(this.saveResultToCache(),void this.stopRoutine()):void 0;this.state=m.WAITING_FOR_USER_ACTION}else this.loggingService.error(v.Pl.INVALID_DIAGNOSTICS_ROUTINE_INFO)}startRoutine(){var e=this;return(0,h.Z)(function*(){if(e.state===m.READY)try{let n=yield e.diagnosticsService.startRoutine(e.argument.category,e.argument.argument);e.state=m.RUNNING,e.routineId=n.id,e.routineInfo=n.info;const i=R.hl.diagnostics.has(e.argument.category)?R.hl.diagnostics.get(e.argument.category):R.Qh;e.intervalId=window.setInterval(()=>{e.state===m.RUNNING&&e.getRoutineStatus()},i),e.handleResponse()}catch(n){e.loggingService.error("Failed to start routine: ",n)}})()}stopRoutine(){var e=this;return(0,h.Z)(function*(){if(e.intervalId&&(window.clearInterval(e.intervalId),e.intervalId=void 0),e.state===m.RUNNING){try{if(e.state=m.STOPPING,void 0===e.routineId)throw"Routine ID is undefined";yield e.diagnosticsService.stopRoutine(e.routineId)}catch(n){e.loggingService.error("Failed to stop routine: ",n)}e.routineId=void 0,e.state=m.READY,e.onTestComplete()}})()}resumeRoutine(){var e=this;return(0,h.Z)(function*(){try{let n=yield e.diagnosticsService.resumeRoutine(e.routineId);e.state=m.RUNNING,e.routineInfo=n.info,e.handleResponse()}catch(n){e.loggingService.error("Failed to resume routine: ",n)}})()}getRoutineStatus(){var e=this;return(0,h.Z)(function*(){try{let n=yield e.diagnosticsService.getRoutineStatus(e.routineId);e.routineInfo=n.info,e.handleResponse()}catch(n){e.loggingService.error("Failed to get routine status: ",n)}})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(S.w),t.Y36(_.e),t.Y36(T))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-routine-v1-test"]],inputs:{index:"index",title:"title",argument:"argument"},outputs:{testCompleted:"testCompleted"},decls:23,vars:8,consts:[[1,"content-container"],[1,"test-title"],[1,"progress-bar-container"],["mode","determinate",1,"progress-bar",3,"value"],[3,"level","output"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2),t._UZ(4,"mat-progress-bar",3),t._uU(5),t.qZA(),t.TgZ(6,"table")(7,"tr")(8,"th"),t._uU(9,"Argument"),t.qZA(),t.TgZ(10,"td"),t._UZ(11,"app-json-viewer",4),t.qZA()(),t.TgZ(12,"tr")(13,"th"),t._uU(14,"Passed"),t.qZA(),t.TgZ(15,"td")(16,"b"),t._uU(17),t.qZA()()(),t.TgZ(18,"tr")(19,"th"),t._uU(20,"Output"),t.qZA(),t.TgZ(21,"td"),t._UZ(22,"app-json-viewer",4),t.qZA()()()()),2&n&&(t.xp6(2),t.Oqu(i.title),t.xp6(2),t.Q6J("value",i.percentage()),t.xp6(1),t.hij(" ",i.percentage(),"% "),t.xp6(6),t.Q6J("level",0)("output",i.argument),t.xp6(6),t.Oqu(i.hasPassed()),t.xp6(5),t.Q6J("level",0)("output",i.routineInfo))},dependencies:[N.pW,D],styles:[".content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px}.test-title[_ngcontent-%COMP%]{line-height:normal;font-size:30px;font-weight:700;flex:0 0 auto}.progress-bar[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;position:relative;border-top:1px solid white;border-bottom:1px solid white;border-left:none;border-right:none;border-collapse:collapse}th[_ngcontent-%COMP%]{width:30%}td[_ngcontent-%COMP%]{width:70%}.progress-bar[_ngcontent-%COMP%]{flex:0 0 auto;width:98%;margin-right:2%}.progress-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin:20px}.offset-left[_ngcontent-%COMP%]{margin-left:-20px}"]})}return s})();var f=function(s){return s.FINISHED="finished",s.INITIALIZED="initialized",s.RUNNING="running",s.WAITING="waiting",s.EXCEPTION="exception",s.CANCELLED="cancelled",s}(f||{});const bt=["testComponentContainer"],It=new Map([[u.ROUTINE_V2,(()=>{class s{constructor(e,n,i){this.testOrchestrator=e,this.loggingService=n,this.routineV2Service=i,this.testCompleted=new t.vpe,this.RoutineV2State=f,this.hasPassed=!1,this.percentage=0,this.routineState=f.FINISHED,this.subscriptions=[]}ngOnDestroy(){void 0!==this.uuid&&this.cancelRoutine(),this.saveResultToCache(),this.subscriptions.forEach(e=>e.unsubscribe())}ngOnInit(){var e=this;return(0,h.Z)(function*(){const n=e.testOrchestrator.getTestConfig(e.index)?.supported;if(null===n||n)try{const i=yield e.routineV2Service.getSubject(e.argument);if(!i.success)return void e.loggingService.error("Failed to get routine V2 subject: ",i.error);if(!i.subject)return void e.loggingService.error("Invalid routine V2 subject: ",i);if(e.subscriptions.push(i.subject.subscribe({next:a=>{e.handleEventResponse(a)}})),e.testOrchestrator.getIsRunningValue())return void e.startRoutine();let o=e.testOrchestrator.getTestResult(e.index);null!==o&&o.percentage>0&&(e.output=o.details,e.hasPassed=o.passed,e.percentage=o.percentage)}catch(i){e.loggingService.error("Failed to initialize routine v2 test: ",i)}else e.output="Routine unsupported"})()}handleEventResponse(e){var n=this;return(0,h.Z)(function*(){switch(e.eventCategory){case v.Q_.INITIALIZED:if(n.output="initialized",n.routineState=f.RUNNING,!n.checkUUID(e.event.uuid))break;break;case v.Q_.RUNNING:{n.output="running...",n.routineState=f.RUNNING;const i=e.event;if(!n.checkUUID(i.uuid))break;i.percentage&&(n.percentage=i.percentage),i.info&&(n.output=i.info);break}case v.Q_.WAITING:{n.routineState=f.WAITING;const i=e.event;if(!n.checkUUID(i.uuid))break;i.percentage&&(n.percentage=i.percentage),n.output="Waiting: "+i.message;break}case v.Q_.EXCEPTION:{n.routineState=f.EXCEPTION;const i=e.event;if(!n.checkUUID(i.uuid))break;n.percentage=0,n.output="Exception: "+i.debugMessage,n.onTestComplete();break}case v.Q_.FINISHED:{n.routineState=f.FINISHED;const i=e.event;if(!n.checkUUID(i.uuid))break;n.percentage=100,n.hasPassed=!!i.hasPassed&&i.hasPassed,n.output=i.detail,n.uuid=void 0,n.onTestComplete();break}}})()}checkUUID(e){return this.uuid===e||(this.loggingService.error("Error: uuid not matched, expected "+this.uuid+" got "+e),!1)}saveResultToCache(){0!==this.percentage&&this.testOrchestrator.saveTestResult(this.index,{title:this.title,testType:u.ROUTINE_V2,percentage:this.percentage,passed:this.hasPassed,details:this.output})}onTestComplete(){this.saveResultToCache(),this.testCompleted.emit()}startRoutine(){var e=this;return(0,h.Z)(function*(){if(!e.uuid)try{const n=yield e.routineV2Service.CreateRoutine(e.argument);if(void 0===n.uuid)throw new TypeError("Create routine error");e.uuid=n.uuid,e.routineState=f.INITIALIZED,e.output=void 0,e.hasPassed=!1,yield e.routineV2Service.StartRoutine(e.uuid),e.percentage=0}catch(n){e.loggingService.error("Failed to start v2 routine: ",n)}})()}cancelRoutine(){var e=this;return(0,h.Z)(function*(){if(e.uuid)try{e.routineState=f.CANCELLED;const n=e.uuid;e.uuid=void 0,yield e.routineV2Service.CancelRoutine(n),e.output="routine cancelled",e.percentage=0}catch(n){e.loggingService.error("Failed to cancel V2 routine: ",n)}})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(T),t.Y36(_.e),t.Y36(y.w))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-routine-v2-test"]],inputs:{index:"index",title:"title",argument:"argument"},outputs:{testCompleted:"testCompleted"},decls:23,vars:8,consts:[[1,"content-container"],[1,"test-title"],[1,"progress-bar-container"],["mode","determinate",1,"progress-bar",3,"value"],[3,"level","output"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2),t._UZ(4,"mat-progress-bar",3),t._uU(5),t.qZA(),t.TgZ(6,"table")(7,"tr")(8,"th"),t._uU(9,"Argument"),t.qZA(),t.TgZ(10,"td"),t._UZ(11,"app-json-viewer",4),t.qZA()(),t.TgZ(12,"tr")(13,"th"),t._uU(14,"Passed"),t.qZA(),t.TgZ(15,"td")(16,"b"),t._uU(17),t.qZA()()(),t.TgZ(18,"tr")(19,"th"),t._uU(20,"Output"),t.qZA(),t.TgZ(21,"td"),t._UZ(22,"app-json-viewer",4),t.qZA()()()()),2&n&&(t.xp6(2),t.Oqu(i.title),t.xp6(2),t.Q6J("value",i.percentage),t.xp6(1),t.hij(" ",i.percentage,"% "),t.xp6(6),t.Q6J("level",0)("output",i.argument),t.xp6(6),t.Oqu(i.hasPassed),t.xp6(5),t.Q6J("level",0)("output",i.output))},dependencies:[N.pW,D],styles:[".content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px}.test-title[_ngcontent-%COMP%]{line-height:normal;font-size:30px;font-weight:700;flex:0 0 auto}.progress-bar[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;position:relative;border-top:1px solid white;border-bottom:1px solid white;border-left:none;border-right:none;border-collapse:collapse}th[_ngcontent-%COMP%]{width:30%}td[_ngcontent-%COMP%]{width:70%}.progress-bar[_ngcontent-%COMP%]{flex:0 0 auto;width:98%;margin-right:2%}.progress-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin:20px}.offset-left[_ngcontent-%COMP%]{margin-left:-20px}"]})}return s})()],[u.DIAGNOSTICS,_t],[u.CAMERA,pt],[u.AUDIO,at]]);let At=(()=>{class s{constructor(e,n){this.testOrchestrator=e,this.loggingService=n,this.AUDIT_PAGE_INDEX=T.AUDIT_PAGE_INDEX,this.isRunning=!1,this.currentTestIndex=this.AUDIT_PAGE_INDEX,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.testOrchestrator.getTestList$().subscribe(e=>{this.testList=e}),this.testOrchestrator.getIsRunning$().subscribe(e=>{this.isRunning=e}),this.testOrchestrator.getCurrentTestIndex$().subscribe(e=>{this.currentTestIndex=e,this.loadComponent(this.currentTestIndex)}))}ngAfterViewInit(){setTimeout(()=>{this.loadComponent(this.currentTestIndex)})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}loadComponent(e){if(this.testComponentContainer){if(this.testComponentContainer.clear(),e<0)return void this.loadAuditComponent();this.loadTestComponent(e)}}loadAuditComponent(){this.testComponentRef=this.testComponentContainer.createComponent(ut)}loadTestComponent(e){var n=this;return(0,h.Z)(function*(){try{const i=n.testList[e];n.testComponentRef=n.testComponentContainer.createComponent(It.get(i.testType)),n.testComponentRef.instance.argument=i.testArgument,n.testComponentRef.instance.title=i.title,n.testComponentRef.instance.index=e,n.testComponentRef.instance.testCompleted.subscribe(()=>n.testCompleted())}catch(i){n.loggingService.error("Error loading test component: ",i)}})()}testCompleted(){this.testOrchestrator.markTestComplete()}runCurrentTest(){this.testComponentRef&&this.testComponentRef.instance.startRoutine()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(T),t.Y36(_.e))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-test-viewer"]],viewQuery:function(n,i){if(1&n&&t.Gf(bt,5,t.s_b),2&n){let o;t.iGM(o=t.CRH())&&(i.testComponentContainer=o.first)}},decls:7,vars:2,consts:[[1,"top-button-row"],["mat-raised-button","",1,"test-operation-button",3,"disabled","click"],["testComponentContainer",""]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return i.testCompleted()}),t._uU(2," Skip this test "),t.qZA(),t.TgZ(3,"button",1),t.NdJ("click",function(){return i.runCurrentTest()}),t._uU(4," Run this test only "),t.qZA()(),t.GkF(5,null,2)),2&n&&(t.xp6(1),t.Q6J("disabled",!i.isRunning||i.currentTestIndex==i.AUDIT_PAGE_INDEX),t.xp6(2),t.Q6J("disabled",i.isRunning||i.currentTestIndex==i.AUDIT_PAGE_INDEX))},dependencies:[b.lW],styles:[".top-button-row[_ngcontent-%COMP%]{height:60px;display:flex;justify-content:first baseline}.test-operation-button[_ngcontent-%COMP%]{margin-right:20px;margin-left:20px}"]})}return s})();const xt=[{path:"",component:(()=>{class s{constructor(e){this.breakpointObserver=e,this.isHandset$=this.breakpointObserver.observe(E.u3.Handset).pipe((0,Y.U)(n=>n.matches),(0,q.d)())}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(E.Yg))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["rma-app-content-layout"]],decls:15,vars:9,consts:[[1,"sidenav-container"],["fixedInViewport","",1,"sidenav",3,"mode","opened","disableClose"],["drawer",""],[1,"sidenav-content-container"],[3,"showToggleSideNavButton"],[1,"app-content-container"],[1,"test-container"],[1,"log-container"]],template:function(n,i){1&n&&(t.TgZ(0,"mat-sidenav-container",0)(1,"mat-sidenav",1,2),t.ALo(3,"async"),t.ALo(4,"async"),t.TgZ(5,"mat-toolbar"),t._uU(6,"RMA Tests"),t.qZA(),t._UZ(7,"app-rma-sidebar"),t.qZA(),t.TgZ(8,"mat-sidenav-content",3),t._UZ(9,"app-header",4),t.TgZ(10,"div",5)(11,"div",6),t._UZ(12,"app-test-viewer"),t.qZA(),t.TgZ(13,"div",7),t._UZ(14,"app-log-viewer"),t.qZA()()()()),2&n&&(t.xp6(1),t.Q6J("mode",t.lcZ(4,7,i.isHandset$)?"over":"side")("opened",!0)("disableClose",!0),t.uIk("role",t.lcZ(3,5,i.isHandset$)?"dialog":"navigation"),t.xp6(8),t.Q6J("showToggleSideNavButton",!1))},dependencies:[x.JX,x.TM,x.Rh,z.Ye,j.G,H,it,At,d.Ov],styles:[".sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav[_ngcontent-%COMP%]{width:300px}mat-sidenav.mat-drawer[_ngcontent-%COMP%]{background-color:var(--app-sidenav-background);color:var(--app-sidenav-color)}mat-sidenav.mat-drawer-side[_ngcontent-%COMP%]{border-right:1px solid var(--app-header-border-bottom-color)}.sidenav[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background-color:var(--app-sidenav-background);color:var(--app-sidenav-color)}.sidenav[_ngcontent-%COMP%]   .mat-list-base[_ngcontent-%COMP%]   .mat-list-item[_ngcontent-%COMP%]{color:var(--app-sidenav-color)}.mat-toolbar.mat-primary[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1}.mat-drawer-content[_ngcontent-%COMP%]{background-color:var(--app-content-background);color:var(--app-content-color)}.sidenav-content-container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%}.app-content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;overflow:auto}.test-container[_ngcontent-%COMP%]{box-sizing:border-box;padding:1rem;flex:0 0 60%;overflow:auto;border-bottom:5px solid var(--app-header-border-bottom-color)}.log-container[_ngcontent-%COMP%]{background-color:var(--app-log-viewer-background);box-sizing:border-box;padding:1rem;flex:0 0 40%;overflow:auto}"]})}return s})(),pathMatch:"prefix"}];let Rt=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({imports:[Z.Bz.forChild(xt),Z.Bz]})}return s})(),wt=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({providers:[T],imports:[Rt,V.m,Q]})}return s})()}}]);